//
// THIS FILE IS AUTOMATICALLY GENERATED.
// DO NOT EDIT.
//
// You can copy this file to your app's src/main/assets directory to
// customizes it for your application.
//
// Adding this file to your project will stop it from being
// overwritten on each build, so you can peacefully
// customize it.
//
// THIS FILE IS AUTOMATICALLY GENERATED.
// DO NOT EDIT.
//

//
// This file is used to load Capacitor plugins from capacitor-packages.json.
//
// THIS FILE IS AUTOMATICALLY GENERATED.
// DO NOT EDIT.
//
import groovy.json.JsonSlurper
import org.gradle.api.Project
import java.io.File

def knownPlugins = []

def configJson = new File(capacitorProjectRoot, "capacitor.config.json")
def packagesJson = new File(capacitorProjectRoot, "capacitor-packages.json")

def loadPlugins(File jsonFile, Project project) {
    if (jsonFile.exists()) {
        def json = new JsonSlurper().parse(jsonFile)
        json.plugins.each { plugin ->
            def name = plugin.name
            def path = plugin.path
            
            // Construct the correct path to the plugin directory
            def pluginDir = new File(capacitorProjectRoot, path)
            
            if (pluginDir.exists()) {
                def androidPath = plugin.android.path
                def pluginProjectDir = new File(pluginDir, androidPath)
                
                if (pluginProjectDir.exists() && !knownPlugins.contains(name)) {
                    project.dependencies.add("implementation", project.project(":" + name))
                    knownPlugins.add(name)
                }
            } else {
                project.logger.warn("Plugin " + name + " not found at path " + pluginDir.getAbsolutePath())
            }
        }
    }
}

if (packagesJson.exists()) {
  loadPlugins(packagesJson, project)
} else if (configJson.exists()) {
  loadPlugins(configJson, project)
}
